import psycopg2
import sys
import json
from decimal import Decimal

def decimal_default(obj):
    if isinstance(obj, Decimal):
        return float(obj)
    raise TypeError

def fetch_data(query):
    # Connect to the database
    conn = psycopg2.connect(database="mydatabase", user="myuser", password="mypassword", host="localhost", port="5432")
    cur = conn.cursor()

    # Execute the query and retrieve up to 100 records
    cur.execute(query)
    rows = cur.fetchall()

    # Close the cursor and database connection
    cur.close()
    conn.close()

    # Check if the size of the rows variable is less than 6MB and the query starts with "SELECT"
    rows_size = sys.getsizeof(json.dumps(rows, default=decimal_default))
    if rows_size < 6000000 and query.lower().startswith("select"):
        # Return the fetched rows
        return rows
    elif rows_size > 6000000:
        # Return a message indicating that the query result is too large to display
        return "Query result is too large to display"
    else:
        return "Error: Invalid query"
